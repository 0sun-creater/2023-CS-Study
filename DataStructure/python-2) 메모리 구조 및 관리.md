# 파이썬
## 메모리 관리
모든 파이썬 객체와 데이터 구조를 포함하는 비공개 힙(private heap)은 python memory manager가 비공개적으로 알아서 관리한다.  
</br>
- 메모리 관리를 위해 숨겨진 힙 스페이스 사용한다.  
- python memory manger는 힙 메모리에 있는 객체를 참조하는 형태로 동적할당을 자동으로 해준다    
- 인터프리터가 스페이스를 관리하기 때문에 프로그래머 조차도 이 공간에 접근이 불가능 하다.  
- 인터프리터가 포인터를 사용하여 힙 메모리 영역의 범위를 조정, 메모리가 필요할때마다 OS와 소통하면서 할당    
</br>

- 빌트인 가비지 컬렉터(Garbage Collector; GC)를 소유하고 있다.
- GC를 이용하여 사용되지 않은 메모리를 재활용하고 메모리를 지워 힙 스페이스에서 사용 가능케 한다.


</br>

## 메모리 구조  

</br>

|정적 메모리|동적 메모리|
|-----|-----|
|컴파일 시 메모리 할당|런타임 시 메모리 할당|
|고정 크기로만 정적 배열 선언|연산자를 사용하여 배열 선언|
|스택은 정적 할당을 구현하는 데 사용|힙은 동적 할당을 구현하는 데 사용|
|메모리 재사용 불가능|메모리 재사용 가능|

</br>


- **스택(stack) 영역**  
  - 지역변수/ 매개변수 저장  
  - 함수가 호출될 때 할당되고 호출이 끝나면 소멸  
  - 참조자 저장  

</br>

- **힙(heap) 영역**  
  - new 명령으로 생성된 인스턴스 변수(사용자의 동적할당)가 저장  
  - 메소드 호출이 끝나도 소멸되지 않음   
  - 객체 저장  

</br>

- **데이터(data) 영역**
  - 전역변수/정적변수 저장
  - 프로그램이 시작될 때 할당되고 프로그램이 종료되면 소멸 
 
</br>
 
- **코드(text) 영역**
  -  실행할 프로그램의 코드 저장
</br>

![image](https://github.com/0sun-creater/2023-CS-Study/assets/54173210/08f6f553-dd52-4282-b9bc-d48e71fd4b74)


</br>

</br>


## Garbage Collector 작동 방식

- 파이썬은 객체를 레퍼런스 카운트를 통해 관리
- 객체를 참조하는 횟수가 늘어날수록 해당 객체의 레퍼런스 카운트는 증가, 참조 횟수가 줄어들수록 감소 
- 레퍼런스 카운트가 0이 되면 객체는 메모리에서 해제
- 단, 레퍼런스 카운트가 0이 아닌 경우에도 자가 참조 혹은 삭제된 객체들이 순환 참조되어 도달할 수 없는 경우에도 메모리에서 해제

- 가비지 컬렉터는 세대와 임계값을 통해 가비지 컬렉션의 주기 관리

- 새로운 객체가 만들어 질 때 파이썬은 _PyObject_GC_Alloc() 호출
- 객체를 메모리에 할당하고 가비지 컬렉션을 진행한다.

Python 나갈 때 왜 모든 memory가 할당 해제되지 않는지?
- C에서 예약된 메모리 할당 해제는 불가능

Shallow / Deep copy
- Shallow copy : 새로운 instance가 생성될 때 사용
- Deep copy : 이미 복사된 값 저장할 때 사용

## 파이썬 리스트/배열/튜플/클래스 내부구조 및 메모리 할당
https://kadensungbincho.tistory.com/59


# Reference
[파이썬 메모리 공식문서] https://docs.python.org/ko/3/c-api/memory.html
